<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MatchingProps</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    @layer base {
      body {
        @apply bg-gray-950 text-gray-100 font-inter antialiased;
      }
      .container {
        @apply max-w-3xl mx-auto p-6;
      }
      .card {
        @apply bg-gray-800 rounded-lg shadow-lg p-6;
      }
      .input {
        @apply w-full p-3 rounded bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-400;
      }
      .button {
        @apply bg-yellow-400 text-gray-900 p-3 rounded font-medium hover:bg-yellow-300 transition w-full;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const API_BASE = "https://matchingprops.onrender.com";
    let token = localStorage.getItem("token");
    let companiaId = localStorage.getItem("companiaId");

    const Login = ({ onLogin }) => {
      const [email, setEmail] = useState("");
      const [password, setPassword] = useState("");

      const handleSubmit = async (e) => {
        e.preventDefault();
        try {
          const response = await fetch(`${API_BASE}/auth/login`, {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: new URLSearchParams({ username: email, password }),
          });
          const data = await response.json();
          if (response.ok) {
            token = data.access_token;
            const payload = JSON.parse(atob(data.access_token.split(".")[1]));
            companiaId = payload.compania_id;
            localStorage.setItem("token", token);
            localStorage.setItem("companiaId", companiaId);
            onLogin();
          } else {
            alert("Login incorrecto: " + data.detail);
          }
        } catch (error) {
          alert("Error en el login: " + error.message);
        }
      };

      return (
        <div className="container min-h-screen flex items-center justify-center">
          <div className="card w-full">
            <h1 className="text-3xl font-semibold mb-6 text-center">MatchingProps</h1>
            <h2 className="text-xl font-medium mb-6 text-center">Iniciar Sesión</h2>
            <form onSubmit={handleSubmit} className="space-y-4">
              <input
                type="email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                placeholder="Correo electrónico"
                className="input"
                required
              />
              <input
                type="password"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                placeholder="Contraseña"
                className="input"
                required
              />
              <button type="submit" className="button">Entrar</button>
            </form>
          </div>
        </div>
      );
    };

    const ClientForm = ({ onRegister }) => {
      const [formData, setFormData] = useState({
        nombre: "", telefono: "", zona: [], subzonas: "", entrada: "", precio: "",
        tipo_vivienda: [], finalidad: [], habitaciones: [], banos: [], estado: "",
        ascensor: "", bajos: "", entreplanta: "", m2: "", altura: "", cercania_metro: "",
        orientacion: [], edificio_semi_nuevo: "", adaptado_movilidad: "", balcon: "",
        patio: "", terraza: "", garaje: "", trastero: "", interior: "", piscina: "",
        urbanizacion: "", vistas: "", caracteristicas_adicionales: "", banco: "",
        permuta: "", ahorro: ""
      });

      const handleChange = (e) => {
        const { name, value, selectedOptions } = e.target;
        if (["zona", "tipo_vivienda", "finalidad", "habitaciones", "banos", "orientacion"].includes(name)) {
          setFormData({ ...formData, [name]: Array.from(selectedOptions, opt => opt.value) });
        } else {
          setFormData({ ...formData, [name]: value });
        }
      };

      const handleSubmit = async (e) => {
        e.preventDefault();
        const cliente = {
          ...formData, compania_id: companiaId,
          entrada: parseFloat(formData.entrada) || 0,
          precio: parseFloat(formData.precio) || 0,
          m2: parseInt(formData.m2) || 0,
          ahorro: parseFloat(formData.ahorro) || 0,
          habitaciones: formData.habitaciones.map(Number)
        };
        try {
          const response = await fetch(`${API_BASE}/clientes`, {
            method: "POST",
            headers: { "Content-Type": "application/json", Authorization: `Bearer ${token}` },
            body: JSON.stringify(cliente),
          });
          if (response.ok) {
            alert("Cliente registrado con éxito");
            onRegister();
          } else {
            const data = await response.json();
            alert("Error: " + data.detail);
          }
        } catch (error) {
          alert("Error: " + error.message);
        }
      };

      return (
        <div className="container mt-6">
          <div className="card">
            <h2 className="text-2xl font-semibold mb-6 text-center">Registrar Cliente</h2>
            <form onSubmit={handleSubmit} className="grid grid-cols-1 gap-4">
              <input name="nombre" value={formData.nombre} onChange={handleChange} placeholder="Nombre" className="input" required />
              <input name="telefono" value={formData.telefono} onChange={handleChange} placeholder="Teléfono" className="input" required />
              <select name="zona" multiple value={formData.zona} onChange={handleChange} className="input" required>
                <option value="ALTO">ALTO</option>
                <option value="OLIVOS">OLIVOS</option>
                <option value="LAGUNA">LAGUNA</option>
                <option value="BATÁN">BATÁN</option>
                <option value="SEPÚLVEDA">SEPÚLVEDA</option>
                <option value="MANZANARES">MANZANARES</option>
                <option value="PÍO">PÍO</option>
                <option value="PUERTA">PUERTA</option>
                <option value="JESUITAS">JESUITAS</option>
              </select>
              <input name="subzonas" value={formData.subzonas} onChange={handleChange} placeholder="Subzonas" className="input" />
              <select name="entrada" value={formData.entrada} onChange={handleChange} className="input" required>
                <option value="">Entrada</option>
                {[...Array(50).keys()].map(i => <option key={i * 10000 + 10000} value={i * 10000 + 10000}>{(i * 10000 + 10000).toLocaleString()}€</option>)}
              </select>
              <select name="precio" value={formData.precio} onChange={handleChange} className="input" required>
                <option value="">Precio</option>
                {[...Array(60).keys()].map(i => <option key={i * 10000 + 10000} value={i * 10000 + 10000}>{(i * 10000 + 10000).toLocaleString()}€</option>)}
              </select>
              <select name="tipo_vivienda" multiple value={formData.tipo_vivienda} onChange={handleChange} className="input">
                <option value="Piso">Piso</option>
                <option value="Casa">Casa</option>
                <option value="Chalet">Chalet</option>
                <option value="Adosado">Adosado</option>
                <option value="Dúplex">Dúplex</option>
                <option value="Ático">Ático</option>
                <option value="Estudio">Estudio</option>
              </select>
              <select name="finalidad" multiple value={formData.finalidad} onChange={handleChange} className="input">
                <option value="Primera Vivienda">Primera Vivienda</option>
                <option value="Inversión">Inversión</option>
              </select>
              <select name="habitaciones" multiple value={formData.habitaciones} onChange={handleChange} className="input">
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
              </select>
              <select name="banos" multiple value={formData.banos} onChange={handleChange} className="input">
                <option value="1">1</option>
                <option value="1+1">1+1</option>
                <option value="2">2</option>
              </select>
              <select name="estado" value={formData.estado} onChange={handleChange} className="input">
                <option value="">Estado</option>
                <option value="Obra Nueva">Obra Nueva</option>
                <option value="Buen Estado">Buen Estado</option>
                <option value="A Reformar">A Reformar</option>
              </select>
              <select name="ascensor" value={formData.ascensor} onChange={handleChange} className="input">
                <option value="">Ascensor</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
                <option value="HASTA 1º">HASTA 1º</option>
                <option value="HASTA 2º">HASTA 2º</option>
                <option value="HASTA 3º">HASTA 3º</option>
                <option value="HASTA 4º">HASTA 4º</option>
                <option value="HASTA 5º">HASTA 5º</option>
              </select>
              <select name="bajos" value={formData.bajos} onChange={handleChange} className="input">
                <option value="">Bajos</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <select name="entreplanta" value={formData.entreplanta} onChange={handleChange} className="input">
                <option value="">Entreplanta</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <select name="m2" value={formData.m2} onChange={handleChange} className="input" required>
                <option value="">Metros Cuadrados</option>
                <option value="30">30</option>
                <option value="40">40</option>
                <option value="50">50</option>
                <option value="60">60</option>
                <option value="70">70</option>
                <option value="80">80</option>
                <option value="90">90</option>
                <option value="100">100</option>
                <option value="110">110</option>
                <option value="120">120</option>
                <option value="130">130</option>
                <option value="150">150</option>
              </select>
              <select name="altura" value={formData.altura} onChange={handleChange} className="input">
                <option value="">Altura</option>
                <option value="Primeras Plantas">Primeras Plantas</option>
                <option value="Plantas Intermedias">Plantas Intermedias</option>
                <option value="Últimas Plantas">Últimas Plantas</option>
              </select>
              <select name="cercania_metro" value={formData.cercania_metro} onChange={handleChange} className="input">
                <option value="">Cercanía Metro</option>
                <option value="<5 MINUTOS">&lt;5 MINUTOS</option>
                <option value="<10 MINUTOS">&lt;10 MINUTOS</option>
                <option value="<15 MINUTOS">&lt;15 MINUTOS</option>
                <option value="Indiferente">Indiferente</option>
              </select>
              <select name="orientacion" multiple value={formData.orientacion} onChange={handleChange} className="input">
                <option value="Norte">Norte</option>
                <option value="Sur">Sur</option>
                <option value="Este">Este</option>
                <option value="Oeste">Oeste</option>
                <option value="Indiferente">Indiferente</option>
              </select>
              <select name="edificio_semi_nuevo" value={formData.edificio_semi_nuevo} onChange={handleChange} className="input">
                <option value="">Edificio Semi-Nuevo</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <select name="adaptado_movilidad" value={formData.adaptado_movilidad} onChange={handleChange} className="input">
                <option value="">Adaptado Movilidad</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <select name="balcon" value={formData.balcon} onChange={handleChange} className="input">
                <option value="">Balcón</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <select name="patio" value={formData.patio} onChange={handleChange} className="input">
                <option value="">Patio</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <select name="terraza" value={formData.terraza} onChange={handleChange} className="input">
                <option value="">Terraza</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <select name="garaje" value={formData.garaje} onChange={handleChange} className="input">
                <option value="">Garaje</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <select name="trastero" value={formData.trastero} onChange={handleChange} className="input">
                <option value="">Trastero</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <select name="interior" value={formData.interior} onChange={handleChange} className="input">
                <option value="">Interior</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <select name="piscina" value={formData.piscina} onChange={handleChange} className="input">
                <option value="">Piscina</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <select name="urbanizacion" value={formData.urbanizacion} onChange={handleChange} className="input">
                <option value="">Urbanización</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <input name="vistas" value={formData.vistas} onChange={handleChange} placeholder="Vistas" className="input" />
              <input name="caracteristicas_adicionales" value={formData.caracteristicas_adicionales} onChange={handleChange} placeholder="Características Adicionales" className="input" />
              <input name="banco" value={formData.banco} onChange={handleChange} placeholder="Banco" className="input" />
              <select name="permuta" value={formData.permuta} onChange={handleChange} className="input">
                <option value="">Permuta</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <input name="ahorro" value={formData.ahorro} onChange={handleChange} placeholder="Ahorro (€)" className="input" />
              <button type="submit" className="button mt-4">Registrar Cliente</button>
            </form>
          </div>
        </div>
      );
    };

    const PisoForm = ({ onRegister }) => {
      const [formData, setFormData] = useState({
        zona: [], precio: "", tipo_vivienda: [], habitaciones: [], banos: [], estado: "",
        ascensor: "", bajos: "", entreplanta: "", m2: "", altura: "", cercania_metro: "",
        orientacion: [], edificio_semi_nuevo: "", adaptado_movilidad: "", balcon: "",
        patio: "", terraza: "", garaje: "", trastero: "", interior: "", piscina: "",
        urbanizacion: "", vistas: "", caracteristicas_adicionales: ""
      });

      const handleChange = (e) => {
        const { name, value, selectedOptions } = e.target;
        if (["zona", "tipo_vivienda", "habitaciones", "banos", "orientacion"].includes(name)) {
          setFormData({ ...formData, [name]: Array.from(selectedOptions, opt => opt.value) });
        } else {
          setFormData({ ...formData, [name]: value });
        }
      };

      const handleSubmit = async (e) => {
        e.preventDefault();
        const piso = {
          ...formData, compania_id: companiaId,
          precio: parseFloat(formData.precio) || 0,
          m2: parseInt(formData.m2) || 0,
          habitaciones: formData.habitaciones.map(Number)
        };
        try {
          const response = await fetch(`${API_BASE}/pisos`, {
            method: "POST",
            headers: { "Content-Type": "application/json", Authorization: `Bearer ${token}` },
            body: JSON.stringify(piso),
          });
          if (response.ok) {
            alert("Piso registrado con éxito");
            onRegister();
          } else {
            const data = await response.json();
            alert("Error: " + data.detail);
          }
        } catch (error) {
          alert("Error: " + error.message);
        }
      };

      return (
        <div className="container mt-6">
          <div className="card">
            <h2 className="text-2xl font-semibold mb-6 text-center">Registrar Piso</h2>
            <form onSubmit={handleSubmit} className="grid grid-cols-1 gap-4">
              <select name="zona" multiple value={formData.zona} onChange={handleChange} className="input" required>
                <option value="ALTO">ALTO</option>
                <option value="OLIVOS">OLIVOS</option>
                <option value="LAGUNA">LAGUNA</option>
                <option value="BATÁN">BATÁN</option>
                <option value="SEPÚLVEDA">SEPÚLVEDA</option>
                <option value="MANZANARES">MANZANARES</option>
                <option value="PÍO">PÍO</option>
                <option value="PUERTA">PUERTA</option>
                <option value="JESUITAS">JESUITAS</option>
              </select>
              <input name="precio" value={formData.precio} onChange={handleChange} placeholder="Precio (€)" className="input" required />
              <select name="tipo_vivienda" multiple value={formData.tipo_vivienda} onChange={handleChange} className="input">
                <option value="Piso">Piso</option>
                <option value="Casa">Casa</option>
                <option value="Chalet">Chalet</option>
                <option value="Adosado">Adosado</option>
                <option value="Dúplex">Dúplex</option>
                <option value="Ático">Ático</option>
                <option value="Estudio">Estudio</option>
              </select>
              <select name="habitaciones" multiple value={formData.habitaciones} onChange={handleChange} className="input">
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
              </select>
              <select name="banos" multiple value={formData.banos} onChange={handleChange} className="input">
                <option value="1">1</option>
                <option value="1+1">1+1</option>
                <option value="2">2</option>
              </select>
              <select name="estado" value={formData.estado} onChange={handleChange} className="input">
                <option value="">Estado</option>
                <option value="Obra Nueva">Obra Nueva</option>
                <option value="Buen Estado">Buen Estado</option>
                <option value="A Reformar">A Reformar</option>
              </select>
              <select name="ascensor" value={formData.ascensor} onChange={handleChange} className="input">
                <option value="">Ascensor</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
                <option value="HASTA 1º">HASTA 1º</option>
                <option value="HASTA 2º">HASTA 2º</option>
                <option value="HASTA 3º">HASTA 3º</option>
                <option value="HASTA 4º">HASTA 4º</option>
                <option value="HASTA 5º">HASTA 5º</option>
              </select>
              <select name="bajos" value={formData.bajos} onChange={handleChange} className="input">
                <option value="">Bajos</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <select name="entreplanta" value={formData.entreplanta} onChange={handleChange} className="input">
                <option value="">Entreplanta</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <select name="m2" value={formData.m2} onChange={handleChange} className="input" required>
                <option value="">Metros Cuadrados</option>
                <option value="30">30</option>
                <option value="40">40</option>
                <option value="50">50</option>
                <option value="60">60</option>
                <option value="70">70</option>
                <option value="80">80</option>
                <option value="90">90</option>
                <option value="100">100</option>
                <option value="110">110</option>
                <option value="120">120</option>
                <option value="130">130</option>
                <option value="150">150</option>
              </select>
              <select name="altura" value={formData.altura} onChange={handleChange} className="input">
                <option value="">Altura</option>
                <option value="Primeras Plantas">Primeras Plantas</option>
                <option value="Plantas Intermedias">Plantas Intermedias</option>
                <option value="Últimas Plantas">Últimas Plantas</option>
              </select>
              <select name="cercania_metro" value={formData.cercania_metro} onChange={handleChange} className="input">
                <option value="">Cercanía Metro</option>
                <option value="<5 MINUTOS">&lt;5 MINUTOS</option>
                <option value="<10 MINUTOS">&lt;10 MINUTOS</option>
                <option value="<15 MINUTOS">&lt;15 MINUTOS</option>
                <option value="Indiferente">Indiferente</option>
              </select>
              <select name="orientacion" multiple value={formData.orientacion} onChange={handleChange} className="input">
                <option value="Norte">Norte</option>
                <option value="Sur">Sur</option>
                <option value="Este">Este</option>
                <option value="Oeste">Oeste</option>
                <option value="Indiferente">Indiferente</option>
              </select>
              <select name="edificio_semi_nuevo" value={formData.edificio_semi_nuevo} onChange={handleChange} className="input">
                <option value="">Edificio Semi-Nuevo</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <select name="adaptado_movilidad" value={formData.adaptado_movilidad} onChange={handleChange} className="input">
                <option value="">Adaptado Movilidad</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <select name="balcon" value={formData.balcon} onChange={handleChange} className="input">
                <option value="">Balcón</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <select name="patio" value={formData.patio} onChange={handleChange} className="input">
                <option value="">Patio</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <select name="terraza" value={formData.terraza} onChange={handleChange} className="input">
                <option value="">Terraza</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <select name="garaje" value={formData.garaje} onChange={handleChange} className="input">
                <option value="">Garaje</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <select name="trastero" value={formData.trastero} onChange={handleChange} className="input">
                <option value="">Trastero</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <select name="interior" value={formData.interior} onChange={handleChange} className="input">
                <option value="">Interior</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <select name="piscina" value={formData.piscina} onChange={handleChange} className="input">
                <option value="">Piscina</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <select name="urbanizacion" value={formData.urbanizacion} onChange={handleChange} className="input">
                <option value="">Urbanización</option>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
              <input name="vistas" value={formData.vistas} onChange={handleChange} placeholder="Vistas" className="input" />
              <input name="caracteristicas_adicionales" value={formData.caracteristicas_adicionales} onChange={handleChange} placeholder="Características Adicionales" className="input" />
              <button type="submit" className="button mt-4">Registrar Piso</button>
            </form>
          </div>
        </div>
      );
    };

    const SearchClientes = () => {
      const [pisos, setPisos] = useState([]);
      const [results, setResults] = useState([]);

      useEffect(() => {
        fetchPisos();
      }, []);

      const fetchPisos = async () => {
        try {
          const response = await fetch(`${API_BASE}/pisos`, { headers: { Authorization: `Bearer ${token}` } });
          setPisos(await response.json());
        } catch (error) {
          alert("Error al cargar pisos: " + error.message);
        }
      };

      const handleSearch = async () => {
        const pisoId = document.getElementById("pisoSelect").value;
        if (!pisoId) {
          alert("Selecciona un piso");
          return;
        }
        try {
          const response = await fetch(`${API_BASE}/match?piso_id=${pisoId}`, { headers: { Authorization: `Bearer ${token}` } });
          setResults(await response.json());
        } catch (error) {
          alert("Error al buscar clientes: " + error.message);
        }
      };

      return (
        <div className="container mt-6">
          <div className="card">
            <h2 className="text-2xl font-semibold mb-6 text-center">Buscar Clientes</h2>
            <div className="space-y-4">
              <select id="pisoSelect" className="input">
                <option value="">Seleccionar un piso...</option>
                {pisos.map(piso => <option key={piso.id} value={piso.id}>Piso {piso.id} - {piso.zona} ({piso.precio}€)</option>)}
              </select>
              <button onClick={handleSearch} className="button">Buscar</button>
              {results.length > 0 && (
                <div className="mt-4">
                  <h3 className="text-xl font-medium mb-2">Clientes Compatibles</h3>
                  <ul className="list-disc pl-5 space-y-2">
                    {results.map(match => (
                      <li key={match.cliente_id}>Cliente {match.cliente_id} (Score: {match.score}%)</li>
                    ))}
                  </ul>
                </div>
              )}
            </div>
          </div>
        </div>
      );
    };

    const SearchPisos = () => {
      const [clientes, setClientes] = useState([]);
      const [results, setResults] = useState([]);

      useEffect(() => {
        fetchClientes();
      }, []);

      const fetchClientes = async () => {
        try {
          const response = await fetch(`${API_BASE}/clientes`, { headers: { Authorization: `Bearer ${token}` } });
          setClientes(await response.json());
        } catch (error) {
          alert("Error al cargar clientes: " + error.message);
        }
      };

      const handleSearch = async () => {
        const clienteId = document.getElementById("clienteSelect").value;
        if (!clienteId) {
          alert("Selecciona un cliente");
          return;
        }
        try {
          const response = await fetch(`${API_BASE}/match?cliente_id=${clienteId}`, { headers: { Authorization: `Bearer ${token}` } });
          setResults(await response.json());
        } catch (error) {
          alert("Error al buscar pisos: " + error.message);
        }
      };

      return (
        <div className="container mt-6">
          <div className="card">
            <h2 className="text-2xl font-semibold mb-6 text-center">Buscar Pisos</h2>
            <div className="space-y-4">
              <select id="clienteSelect" className="input">
                <option value="">Seleccionar un cliente...</option>
                {clientes.map(cliente => <option key={cliente.id} value={cliente.id}>{cliente.nombre || `Cliente ${cliente.id}`} - {cliente.zona}</option>)}
              </select>
              <button onClick={handleSearch} className="button">Buscar</button>
              {results.length > 0 && (
                <div className="mt-4">
                  <h3 className="text-xl font-medium mb-2">Pisos Compatibles</h3>
                  <ul className="list-disc pl-5 space-y-2">
                    {results.map(match => (
                      <li key={match.piso_id}>Piso {match.piso_id} (Score: {match.score}%)</li>
                    ))}
                  </ul>
                </div>
              )}
            </div>
          </div>
        </div>
      );
    };

    const App = () => {
      const [isLoggedIn, setIsLoggedIn] = useState(!!token);

      const handleLogin = () => setIsLoggedIn(true);

      return (
        <div className="min-h-screen">
          {!isLoggedIn ? <Login onLogin={handleLogin} /> : (
            <div className="container">
              <h1 className="text-3xl font-semibold mb-8 text-center">MatchingProps</h1>
              <ClientForm onRegister={() => {}} />
              <PisoForm onRegister={() => {}} />
              <SearchClientes />
              <SearchPisos />
            </div>
          )}
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>
